<meta charset="utf-8">
<html lang="ko">
<link rel="stylesheet" type="text/css" href="../style.css"/>
<body>
<div class="wrap-right">
    <main class="main ">
        <div class="area-main">
             <div class="article-header">
                 <a href="/" class="link_post">ecsimsw</a>
젠킨스 삽질 과정에서 배운 것들             </div>
             <div class="article-view">
                 <h4 data-ke-size="size20"><b><span style="color: #000000;">젠킨스&nbsp;삽질&nbsp;과정에서&nbsp;배운&nbsp;것들</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">Jenkins를 설정하면서 다음을 배웠다.</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">1. 리눅스 가상 메모리 설정 (스왑 파일 생성)</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">aws 프리티어 인스턴스가 지나치게 느려 메모리 문제임을 확인하고 가상 메모리를 설정하였다.&nbsp;</span><span style="color: #000000;">코틀린 빌드 시간이 말도 안되게 느렸고, 가상 메모리로 해당 문제를 해결할 수 있었다.&nbsp;</span><span style="color: #000000;">(결국 용량 문제로 Medium으로 갈아탔다.. )</span></p> 
<p data-ke-size="size16"><span style="color: #000000;">&nbsp;</span></p> 
<figure id="og_1625334023951" contenteditable="false" data-ke-type="opengraph" data-ke-align="alignCenter" data-og-type="company" data-og-title="스왑 파일을 사용하여 Amazon EC2 인스턴스의 스왑 공간으로 메모리 할당" data-og-description="1.&nbsp;&nbsp;&nbsp;&nbsp;dd 명령을 사용하여 루트 파일 시스템에 스왑 파일을 생성합니다. 명령에서 bs는 블록 크기이고 count는 블록 수입니다. 스왑 파일의 크기는 dd 명령의 블록 크기 옵션에 블록 수 옵션을 곱" data-og-host="aws.amazon.com" data-og-source-url="https://aws.amazon.com/ko/premiumsupport/knowledge-center/ec2-memory-swap-file/" data-og-url="https://aws.amazon.com/ko/premiumsupport/knowledge-center/ec2-memory-swap-file/" data-og-image="https://scrap.kakaocdn.net/dn/deACcP/hyKLoBPzki/Q4fPrGsIcaNVcyzSK74dck/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630,https://scrap.kakaocdn.net/dn/KcESY/hyKLzQStEA/1pq6b10pTkkGsduL1cSifK/img.png?width=179&amp;height=109&amp;face=0_0_179_109,https://scrap.kakaocdn.net/dn/vbKma/hyKMM19MNE/AMxjLA8nxDsQhHNrUlEEv1/img.jpg?width=2560&amp;height=1438&amp;face=1008_348_1432_812">
 <a href="https://aws.amazon.com/ko/premiumsupport/knowledge-center/ec2-memory-swap-file/" data-source-url="https://aws.amazon.com/ko/premiumsupport/knowledge-center/ec2-memory-swap-file/"> 
  <div class="og-image" style="background-image: url('https://scrap.kakaocdn.net/dn/deACcP/hyKLoBPzki/Q4fPrGsIcaNVcyzSK74dck/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630,https://scrap.kakaocdn.net/dn/KcESY/hyKLzQStEA/1pq6b10pTkkGsduL1cSifK/img.png?width=179&amp;height=109&amp;face=0_0_179_109,https://scrap.kakaocdn.net/dn/vbKma/hyKMM19MNE/AMxjLA8nxDsQhHNrUlEEv1/img.jpg?width=2560&amp;height=1438&amp;face=1008_348_1432_812');">
   &nbsp;
  </div> 
  <div class="og-text"> 
   <p class="og-title" data-ke-size="size16">스왑 파일을 사용하여 Amazon EC2 인스턴스의 스왑 공간으로 메모리 할당</p> 
   <p class="og-desc" data-ke-size="size16">1.&nbsp;&nbsp;&nbsp;&nbsp;dd 명령을 사용하여 루트 파일 시스템에 스왑 파일을 생성합니다. 명령에서 bs는 블록 크기이고 count는 블록 수입니다. 스왑 파일의 크기는 dd 명령의 블록 크기 옵션에 블록 수 옵션을 곱</p> 
   <p class="og-host" data-ke-size="size16">aws.amazon.com</p> 
  </div> </a>
</figure> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">2. 리눅스 포트포워딩 (iptables)</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">젠킨스 도커 컨테이너 host port를 9090으로 열었었는데 보안 규정상 9090을 사용할 수 없었고, 이 참에 포트포워딩도 공부할겸 적용해서 문제를 해결했다.</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<pre id="code_1625334023952" class="html xml" style="margin: 20px auto 0px; display: block; overflow: auto; padding: 20px; color: #383a42; background-color: #f8f8f8; font-size: 14px; font-family: 'SF Mono', Menlo, Consolas, Monaco, monospace; border: 1px solid #ebebeb; line-height: 1.71; cursor: default; z-index: 1; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none; background-position: initial initial; background-repeat: initial initial;" data-ke-language="html" data-ke-type="codeblock"><code>## 요청 포트를 forwarding하여 내부 포트로 리다이렉트한다.
sudo iptables -t nat -A PREROUTING -p tcp --dport [요청 포트] -j REDIRECT --to-port [내부 포트]

## iptables 확인 with Line number
sudo iptables -t -nat -L --line-numbers

## 설정 삭제
sudo iptables -t nat -D PREROUTING [Line number]</code></pre> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">3. 인터넷 연결 체크</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">요청이 제대로 가고, 응답이 오는지 확인하기 위해 써먹었던 명령어들이다.</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<pre id="code_1625334023953" class="html xml" style="margin: 20px auto 0px; display: block; overflow: auto; padding: 20px; color: #383a42; background-color: #f8f8f8; font-size: 14px; font-family: 'SF Mono', Menlo, Consolas, Monaco, monospace; border: 1px solid #ebebeb; line-height: 1.71; cursor: default; z-index: 1; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none; background-position: initial initial; background-repeat: initial initial;" data-ke-language="html" data-ke-type="codeblock"><code>curl
telnet
tcpdump</code></pre> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">4. 도커 컨테이너 접속(docker exec)</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">젠킨스 서버의 java 버젼을 확인하기 위해 알아보았다.</span></p> 
<pre id="code_1625334023953" class="html xml" style="margin: 20px auto 0px; display: block; overflow: auto; padding: 20px; color: #383a42; background-color: #f8f8f8; font-size: 14px; font-family: 'SF Mono', Menlo, Consolas, Monaco, monospace; border: 1px solid #ebebeb; line-height: 1.71; cursor: default; z-index: 1; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none; background-position: initial initial; background-repeat: initial initial;" data-ke-language="html" data-ke-type="codeblock"><code>docker exec -it [containerId] /bin/bash</code></pre> 
<p data-ke-size="size16">&nbsp;</p> 
<p data-ke-size="size16"><span style="color: #000000;">$ docker exec -it ad740b3002fb /bin/bash</span></p> 
<p data-ke-size="size16"><span style="color: #000000;">jenkins@ad740b3002fb:/$ java -version</span></p> 
<p data-ke-size="size16"><span style="color: #000000;">openjdk version "1.8.0_292"</span></p> 
<p data-ke-size="size16"><span style="color: #000000;">OpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_292-b10)</span></p> 
<p data-ke-size="size16"><span style="color: #000000;">OpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.292-b10, mixed mode)</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">5. Jenkins 무료 버전은 Java 9 까지만..</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">자바 버전 문제로 빌드 오류가 났다.</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<table style="border-collapse: collapse; width: 100%;" border="1" data-ke-align="alignLeft"> 
 <tbody> 
  <tr> 
   <td style="width: 100%;"><span style="color: #000000;"><span style="background-color: #fafafa;">java -jar build/libs/sucotalk-0.0.1-SNAPSHOT.jar&nbsp;<br></span><span style="background-color: #fafafa;">Exception in thread "main" java.lang.UnsupportedClassVersionError: com/suco/sucotalk/SucotalkApplicationKt has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0</span></span></td> 
  </tr> 
 </tbody> 
</table> 
<p data-ke-size="size16">&nbsp;</p> 
<p data-ke-size="size16"><span style="color: #000000;">아래 방식으로 Jenkins JDK 버전을 선택할 수 있고 Java 9 이후로는 무료 버전에서 지원하지 않는다는 것을 확인했다.</span></p> 
<p data-ke-size="size16">&nbsp;</p> 
<pre id="code_1625334023956" class="html xml" style="margin: 20px auto 0px; display: block; overflow: auto; padding: 20px; color: #383a42; background-color: #f8f8f8; font-size: 14px; font-family: 'SF Mono', Menlo, Consolas, Monaco, monospace; border: 1px solid #ebebeb; line-height: 1.71; cursor: default; z-index: 1; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none; background-position: initial initial; background-repeat: initial initial;" data-ke-language="html" data-ke-type="codeblock"><code>Jenkins 설정 &gt; Global Tool Configuration &gt; JDK &gt; JDK installation</code></pre> 
<p data-ke-size="size16">&nbsp;</p> 
<h4 data-ke-size="size20"><b><span style="color: #000000;">6. 코틀린 Java 버전, JVM target 변경</span></b></h4> 
<p data-ke-size="size16"><span style="color: #000000;">build.gradle.kts 에서 Java 버전(JVM target)을 변경할 수 있다. 예시에서는 JVM target을 1.8로 변경하였다.</span></p> 
<pre id="code_1625334023956" class="html xml" style="margin: 20px auto 0px; display: block; overflow: auto; padding: 20px; color: #383a42; background-color: #f8f8f8; font-size: 14px; font-family: 'SF Mono', Menlo, Consolas, Monaco, monospace; border: 1px solid #ebebeb; line-height: 1.71; cursor: default; z-index: 1; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none; background-position: initial initial; background-repeat: initial initial;" data-ke-language="html" data-ke-type="codeblock"><code>tasks.withType&lt;KotlinCompile&gt; {
	kotlinOptions {
		freeCompilerArgs = listOf("-Xjsr305=strict")
		jvmTarget = "1.8"
	}
}</code></pre> 
<p data-ke-size="size16">&nbsp;</p> 
<p data-ke-size="size16">&nbsp;</p> 
<p data-ke-size="size16">&nbsp;</p>             </div>
        </div>
    </main>
</div>
</body>
</html>>